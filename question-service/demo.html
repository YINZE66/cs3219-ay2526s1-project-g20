<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Question Service Demo</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.2em;
        opacity: 0.9;
      }

      .status-bar {
        background: #f8f9fa;
        padding: 15px 30px;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .status {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .status-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #28a745;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }

      .content {
        padding: 30px;
      }

      .section {
        margin-bottom: 30px;
      }

      .section h2 {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.5em;
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn-success {
        background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
      }

      .btn-warning {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }

      .btn-info {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      .result-box {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 20px;
        margin-top: 15px;
        max-height: 400px;
        overflow-y: auto;
      }

      .question-card {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .question-title {
        font-weight: bold;
        color: #333;
        margin-bottom: 8px;
      }

      .question-meta {
        display: flex;
        gap: 15px;
        margin-bottom: 10px;
        font-size: 0.9em;
      }

      .difficulty {
        padding: 4px 8px;
        border-radius: 4px;
        font-weight: bold;
        font-size: 0.8em;
      }

      .difficulty-easy {
        background: #d4edda;
        color: #155724;
      }

      .difficulty-medium {
        background: #fff3cd;
        color: #856404;
      }

      .difficulty-hard {
        background: #f8d7da;
        color: #721c24;
      }

      .categories {
        color: #6c757d;
      }

      .question-description {
        color: #666;
        line-height: 1.5;
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: #666;
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #666;
        font-size: 0.9em;
      }

      .ai-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .ai-section h3 {
        margin-bottom: 15px;
      }

      .ai-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }

      .ai-controls select,
      .ai-controls input {
        padding: 8px 12px;
        border: none;
        border-radius: 4px;
        font-size: 14px;
      }

      .ai-controls button {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
      }

      .ai-controls button:hover {
        background: rgba(255, 255, 255, 0.3);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üöÄ Question Service Demo</h1>
        <p>High-Performance Microservice for Coding Interview Questions</p>
      </div>

      <div class="status-bar">
        <div class="status">
          <div class="status-dot"></div>
          <span
            >Service Status:
            <strong id="serviceStatus">Checking...</strong></span
          >
        </div>
        <div>
          <span>Response Time: <strong id="responseTime">-</strong>ms</span>
        </div>
      </div>

      <div class="content">
        <!-- Statistics Section -->
        <div class="section">
          <h2>üìä Service Statistics</h2>
          <div class="button-group">
            <button class="btn btn-info" onclick="loadStats()">
              Refresh Stats
            </button>
            <button class="btn btn-success" onclick="loadHealth()">
              Health Check
            </button>
          </div>
          <div id="statsContainer" class="result-box">
            <div class="loading">
              Click "Refresh Stats" to load statistics...
            </div>
          </div>
        </div>

        <!-- Questions Section -->
        <div class="section">
          <h2>üìù Questions Database</h2>
          <div class="button-group">
            <button class="btn" onclick="loadQuestions()">
              Load All Questions
            </button>
            <button class="btn btn-success" onclick="loadQuestions('Easy')">
              Easy Questions
            </button>
            <button class="btn btn-warning" onclick="loadQuestions('Medium')">
              Medium Questions
            </button>
            <button class="btn" onclick="loadQuestions('Hard')">
              Hard Questions
            </button>
            <button class="btn btn-info" onclick="loadRandomQuestion()">
              Random Question
            </button>
          </div>
          <div id="questionsContainer" class="result-box">
            <div class="loading">Click a button above to load questions...</div>
          </div>
        </div>

        <!-- AI Generation Section -->
        <div class="ai-section">
          <h3>ü§ñ AI Question Generation</h3>
          <div class="ai-controls">
            <select id="aiDifficulty">
              <option value="Easy">Easy</option>
              <option value="Medium">Medium</option>
              <option value="Hard">Hard</option>
            </select>
            <select id="aiCategory">
              <option value="Arrays">Arrays</option>
              <option value="Algorithms">Algorithms</option>
              <option value="Data Structures">Data Structures</option>
              <option value="Strings">Strings</option>
              <option value="Math">Math</option>
            </select>
            <input
              type="number"
              id="aiCount"
              value="2"
              min="1"
              max="5"
              placeholder="Count"
            />
            <button onclick="generateAIQuestions()">Generate Questions</button>
            <button onclick="generateAndSaveAIQuestions()">
              Generate & Save
            </button>
          </div>
          <div
            id="aiContainer"
            class="result-box"
            style="background: rgba(255, 255, 255, 0.1); color: white"
          >
            <div class="loading">
              Click "Generate Questions" to create AI questions...
            </div>
          </div>
        </div>

        <!-- Performance Section -->
        <div class="section">
          <h2>‚ö° Performance Metrics</h2>
          <div class="button-group">
            <button class="btn btn-info" onclick="loadMetrics()">
              Load Metrics
            </button>
            <button class="btn btn-success" onclick="testPerformance()">
              Test Performance
            </button>
          </div>
          <div id="metricsContainer" class="result-box">
            <div class="loading">
              Click "Load Metrics" to view performance data...
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const API_BASE = "http://localhost:3001";

      // Utility function to make API calls
      async function apiCall(endpoint, options = {}) {
        const startTime = Date.now();
        try {
          const response = await fetch(`${API_BASE}${endpoint}`, {
            headers: {
              "Content-Type": "application/json",
              ...options.headers,
            },
            ...options,
          });
          const data = await response.json();
          const responseTime = Date.now() - startTime;
          updateResponseTime(responseTime);
          return { success: response.ok, data, responseTime };
        } catch (error) {
          const responseTime = Date.now() - startTime;
          updateResponseTime(responseTime);
          return { success: false, error: error.message, responseTime };
        }
      }

      function updateResponseTime(time) {
        document.getElementById("responseTime").textContent = time;
      }

      function updateServiceStatus(status) {
        document.getElementById("serviceStatus").textContent = status;
      }

      // Load service statistics
      async function loadStats() {
        const container = document.getElementById("statsContainer");
        container.innerHTML =
          '<div class="loading">Loading statistics...</div>';

        const result = await apiCall("/api/questions/statistics");

        if (result.success) {
          const stats = result.data;
          container.innerHTML = `
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number">${stats.total}</div>
                            <div class="stat-label">Total Questions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${
                              stats.byDifficulty.find((d) => d._id === "Easy")
                                ?.count || 0
                            }</div>
                            <div class="stat-label">Easy Questions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${
                              stats.byDifficulty.find((d) => d._id === "Medium")
                                ?.count || 0
                            }</div>
                            <div class="stat-label">Medium Questions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${
                              stats.byDifficulty.find((d) => d._id === "Hard")
                                ?.count || 0
                            }</div>
                            <div class="stat-label">Hard Questions</div>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h4>Categories:</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                            ${stats.byCategory
                              .map(
                                (cat) =>
                                  `<span style="background: #e9ecef; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">${cat._id} (${cat.count})</span>`
                              )
                              .join("")}
                        </div>
                    </div>
                `;
        } else {
          container.innerHTML = `<div class="error">Error loading statistics: ${result.error}</div>`;
        }
      }

      // Load health check
      async function loadHealth() {
        const container = document.getElementById("statsContainer");
        container.innerHTML = '<div class="loading">Checking health...</div>';

        const result = await apiCall("/health");

        if (result.success) {
          const health = result.data;
          updateServiceStatus("Healthy");
          container.innerHTML = `
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number">${Math.floor(
                              health.uptime
                            )}s</div>
                            <div class="stat-label">Uptime</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${Math.round(
                              health.memory.heapUsed / 1024 / 1024
                            )}MB</div>
                            <div class="stat-label">Memory Used</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${
                              result.responseTime
                            }ms</div>
                            <div class="stat-label">Response Time</div>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <p><strong>Status:</strong> ${health.message}</p>
                        <p><strong>Timestamp:</strong> ${new Date(
                          health.timestamp
                        ).toLocaleString()}</p>
                    </div>
                `;
        } else {
          updateServiceStatus("Error");
          container.innerHTML = `<div class="error">Health check failed: ${result.error}</div>`;
        }
      }

      // Load questions
      async function loadQuestions(difficulty = null) {
        const container = document.getElementById("questionsContainer");
        container.innerHTML = '<div class="loading">Loading questions...</div>';

        let endpoint = "/api/questions?limit=10";
        if (difficulty) {
          endpoint += `&difficulty=${difficulty}`;
        }

        const result = await apiCall(endpoint);

        if (result.success) {
          const questions = result.data;
          container.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>Showing ${questions.length} questions</strong>
                        ${difficulty ? ` (${difficulty} difficulty)` : ""}
                    </div>
                    ${questions
                      .map(
                        (q) => `
                        <div class="question-card">
                            <div class="question-title">${q.title}</div>
                            <div class="question-meta">
                                <span class="difficulty difficulty-${q.difficulty.toLowerCase()}">${
                          q.difficulty
                        }</span>
                                <span class="categories">${q.categories.join(
                                  ", "
                                )}</span>
                            </div>
                            <div class="question-description">${
                              q.description
                            }</div>
                        </div>
                    `
                      )
                      .join("")}
                `;
        } else {
          container.innerHTML = `<div class="error">Error loading questions: ${result.error}</div>`;
        }
      }

      // Load random question
      async function loadRandomQuestion() {
        const container = document.getElementById("questionsContainer");
        container.innerHTML =
          '<div class="loading">Loading random question...</div>';

        const result = await apiCall("/api/questions/random");

        if (result.success) {
          const question = result.data;
          container.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>Random Question</strong>
                    </div>
                    <div class="question-card">
                        <div class="question-title">${question.title}</div>
                        <div class="question-meta">
                            <span class="difficulty difficulty-${question.difficulty.toLowerCase()}">${
            question.difficulty
          }</span>
                            <span class="categories">${question.categories.join(
                              ", "
                            )}</span>
                        </div>
                        <div class="question-description">${
                          question.description
                        }</div>
                        ${
                          question.examples && question.examples.length > 0
                            ? `
                            <div style="margin-top: 10px;">
                                <strong>Examples:</strong>
                                ${question.examples
                                  .map(
                                    (ex) => `
                                    <div style="margin: 5px 0; padding: 5px; background: #f8f9fa; border-radius: 4px;">
                                        <strong>Input:</strong> ${ex.input}<br>
                                        <strong>Output:</strong> ${ex.output}
                                    </div>
                                `
                                  )
                                  .join("")}
                            </div>
                        `
                            : ""
                        }
                    </div>
                `;
        } else {
          container.innerHTML = `<div class="error">Error loading random question: ${result.error}</div>`;
        }
      }

      // Generate AI questions
      async function generateAIQuestions() {
        const container = document.getElementById("aiContainer");
        container.innerHTML =
          '<div class="loading">Generating AI questions...</div>';

        const difficulty = document.getElementById("aiDifficulty").value;
        const category = document.getElementById("aiCategory").value;
        const count = document.getElementById("aiCount").value;

        const result = await apiCall("/api/questions/generate", {
          method: "POST",
          body: JSON.stringify({
            difficulty,
            categories: [category],
            count: parseInt(count),
          }),
        });

        if (result.success) {
          const questions = result.data;
          const metadata = result.data.metadata || {};
          container.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>Generated ${
                          questions.length
                        } AI Questions</strong>
                        <div style="font-size: 0.9em; opacity: 0.8; margin-top: 5px;">
                            Generated in ${
                              metadata.processingTime || result.responseTime
                            }ms using ${metadata.model || "AI"}
                        </div>
                    </div>
                    ${questions
                      .map(
                        (q) => `
                        <div class="question-card" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);">
                            <div class="question-title">${q.title}</div>
                            <div class="question-meta">
                                <span class="difficulty difficulty-${q.difficulty.toLowerCase()}">${
                          q.difficulty
                        }</span>
                                <span class="categories">${q.categories.join(
                                  ", "
                                )}</span>
                            </div>
                            <div class="question-description">${
                              q.description
                            }</div>
                        </div>
                    `
                      )
                      .join("")}
                `;
        } else {
          container.innerHTML = `<div class="error">Error generating questions: ${result.error}</div>`;
        }
      }

      // Generate and save AI questions
      async function generateAndSaveAIQuestions() {
        const container = document.getElementById("aiContainer");
        container.innerHTML =
          '<div class="loading">Generating and saving AI questions...</div>';

        const difficulty = document.getElementById("aiDifficulty").value;
        const category = document.getElementById("aiCategory").value;
        const count = document.getElementById("aiCount").value;

        const result = await apiCall("/api/questions/generate-and-save", {
          method: "POST",
          body: JSON.stringify({
            difficulty,
            categories: [category],
            count: parseInt(count),
          }),
        });

        if (result.success) {
          const questions = result.data;
          container.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>‚úÖ Generated and saved ${
                          questions.length
                        } AI Questions to database!</strong>
                        <div style="font-size: 0.9em; opacity: 0.8; margin-top: 5px;">
                            Saved in ${result.responseTime}ms
                        </div>
                    </div>
                    ${questions
                      .map(
                        (q) => `
                        <div class="question-card" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);">
                            <div class="question-title">${q.title}</div>
                            <div class="question-meta">
                                <span class="difficulty difficulty-${q.difficulty.toLowerCase()}">${
                          q.difficulty
                        }</span>
                                <span class="categories">${q.categories.join(
                                  ", "
                                )}</span>
                            </div>
                            <div class="question-description">${
                              q.description
                            }</div>
                        </div>
                    `
                      )
                      .join("")}
                `;
        } else {
          container.innerHTML = `<div class="error">Error generating and saving questions: ${result.error}</div>`;
        }
      }

      // Load performance metrics
      async function loadMetrics() {
        const container = document.getElementById("metricsContainer");
        container.innerHTML = '<div class="loading">Loading metrics...</div>';

        const result = await apiCall("/metrics");

        if (result.success) {
          const metrics = result.data;
          container.innerHTML = `
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number">${
                              metrics.uptime
                                ? Math.floor(metrics.uptime)
                                : "N/A"
                            }</div>
                            <div class="stat-label">Uptime (seconds)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${
                              metrics.memory
                                ? Math.round(
                                    metrics.memory.heapUsed / 1024 / 1024
                                  )
                                : "N/A"
                            }</div>
                            <div class="stat-label">Memory (MB)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${
                              metrics.cpu ? metrics.cpu.usage : "N/A"
                            }</div>
                            <div class="stat-label">CPU Usage (%)</div>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h4>Performance Details:</h4>
                        <pre style="background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 0.9em;">${JSON.stringify(
                          metrics,
                          null,
                          2
                        )}</pre>
                    </div>
                `;
        } else {
          container.innerHTML = `<div class="error">Error loading metrics: ${result.error}</div>`;
        }
      }

      // Test performance
      async function testPerformance() {
        const container = document.getElementById("metricsContainer");
        container.innerHTML =
          '<div class="loading">Testing performance...</div>';

        const tests = [];
        const testCount = 5;

        for (let i = 0; i < testCount; i++) {
          const result = await apiCall("/api/questions?limit=5");
          tests.push(result.responseTime);
        }

        const avgTime = tests.reduce((a, b) => a + b, 0) / tests.length;
        const minTime = Math.min(...tests);
        const maxTime = Math.max(...tests);

        container.innerHTML = `
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number">${avgTime.toFixed(1)}ms</div>
                        <div class="stat-label">Average Response</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${minTime}ms</div>
                        <div class="stat-label">Fastest Response</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${maxTime}ms</div>
                        <div class="stat-label">Slowest Response</div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <h4>Performance Test Results:</h4>
                    <p>Tested ${testCount} requests to /api/questions?limit=5</p>
                    <p><strong>Performance Grade:</strong> ${
                      avgTime < 50
                        ? "A+ (Excellent)"
                        : avgTime < 100
                        ? "A (Great)"
                        : avgTime < 200
                        ? "B (Good)"
                        : "C (Needs Improvement)"
                    }</p>
                </div>
            `;
      }

      // Initialize the demo
      window.onload = function () {
        loadHealth();
      };
    </script>
  </body>
</html>
